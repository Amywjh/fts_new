define(["app","require"],function(app,require){"use strict";function ctrl($scope,$compile,$location,$stateParams,$ionicHistory,$ionicLoading,$timeout,$rootScope,$ionicModal,$ionicPopup,Hall,Battle,Prizes,LineUp,Rank,Wode,Thr,RTAll){if(navigator.onLine){$("#online").css("display","none")}else{$("#online").css("display","block")}$scope.sysPar=new sysPar();$scope.prizeStart=$scope.sysPar.prizeStart;$scope.getUserInfo=function(isShow){Hall.user().then(function(data){if(!data.data||data.code!=0){localStorage.removeItem("userId");localStorage.removeItem("nickName");sessionStorage.removeItem("user");return false}localStorage.setItem("userId",data.data.id);sessionStorage.setItem("userId_short",data.data.id);$hp.defaults.headers.common['uk']=data.data.id;$scope.firstCharge=data.data.firstCharge;$scope.userInfoDetial()},function(error){localStorage.removeItem("userId");localStorage.removeItem("nickName");sessionStorage.removeItem("user")})};$scope.userInfoDetial=function(data){if(data){var userData=data;userData.dmd=toThousands(data.dmd);userData.coin=toThousands(data.coin);$scope.userData=userData;$scope.firstCharge=data.firstCharge;var time=new Date().getTime();$scope.userData.head_logo_url=$scope.userData.head_logo_url+'?'+time;return $scope.userData}else{Wode.all().then(function(data){if(!data.data||data.code!=0){var ua=navigator.userAgent.toLowerCase();if(ua.match(/MicroMessenger/i)=="micromessenger"){WeixinJSBridge.call('closeWindow')}return false};sessionStorage.setItem("user",JSON.stringify(data.data));localStorage.setItem("nickName",data.data.name);$scope.userData=angular.copy($scope.userData=angular.copy(data.data));$scope.userData.dmd=toThousands($scope.userData.dmd);$scope.userData.coin=toThousands($scope.userData.coin);var time=new Date().getTime();$scope.userData.head_logo_url=$scope.userData.head_logo_url+'?'+time;$scope.firstCharge=data.data.firstCharge;return $scope.userData},function(error){})}};function battle_default(url){$scope.playerId=1;$scope.matchId=0;$scope.tabIndex=0;$scope.page=1;Battle.list($scope.tabIndex,"",$scope.page).then(function(data){if(data.code){return $ionicLoading.hide()}if(!data.code){sessionStorage.setItem("battle_default",JSON.stringify(data));$timeout(function(){$ionicLoading.hide();$location.path(url)},500)}},function(error){$ionicLoading.hide()});}function rank_default(url){Rank.rankCon(3,1).then(function(data){if(data.code==0){sessionStorage.setItem("rank_default",JSON.stringify(data));$timeout(function(){$ionicLoading.hide();$location.path(url)},500)}else{$ionicLoading.hide()}},function(error){$ionicLoading.hide();$("#online").css("display","block")})}function wode_default(url){Wode.all().then(function(data){if(data.code==0){sessionStorage.setItem("user",JSON.stringify(data.data));$timeout(function(){$ionicLoading.hide();$location.path(url)},500)}else{$ionicLoading.hide()}},function(error){$ionicLoading.hide();$("#online").css("display","block")})}$scope.rankUrl=function(url){$ionicLoading.show();$scope.connectLive();switch(url){case "/tab/main":$timeout(function(){$ionicLoading.hide();$location.path(url)},500);break;case "/tab/battle/3/0/0":battle_default(url);break;case "/tab/rank":rank_default(url);break;case "/tab/wode":wode_default(url);break;default:break}$rootScope.$on('$locationChangeSuccess',function(ev,to,toParams,from,fromParams){$ionicLoading.hide()})};$scope.goMain=function(url){if(!url){url="/tab/main";$location.path(url)}};$scope.playerDetial=function(id,status,detial){if(id){$ionicLoading.show();Thr.playerDetial(id).then(function(data){if(data.code==0){if(sessionStorage.removeItem("playerStatus")){sessionStorage.removeItem("playerStatus")}if(status){if(status.checked){status.disable=false}var statusAll={"status":status,"detial":detial};sessionStorage.setItem("playerStatus",JSON.stringify(statusAll))}sessionStorage.setItem("playerData",JSON.stringify(data));var url="/tab/lineup/qyxx-second/"+id+"/second";$location.path(url);$rootScope.$on('$locationChangeSuccess',function(ev,to,toParams,from,fromParams){$ionicLoading.hide()})}else{sessionStorage.removeItem("playerData");$ionicLoading.hide()}},function(error){sessionStorage.removeItem("playerData");$ionicLoading.hide()})}};var liveDataStateArr=['tab.battleRoomgoing','tab.battle-lineupshow','tab.battle-timeAxis','tab.battle-prizes-going-detial'];$scope.getLiveData=function(playId,roomId,userId,getEventMsg,isChat){var liveDataState=$ionicHistory.currentStateName();if(!window.navigator.onLine){$scope.alertAct(msg,msgOK,playId,roomId,userId,liveDataState,getEventMsg);return}playId=Number(playId);roomId=Number(roomId);userId=Number(userId);RTAll.getItemUser().then(function(data){if(!data.code){WebIM.config.appkey=data.data.appkey;$scope.conn=new WebIM.connection({https:WebIM.config.https,url:WebIM.config.xmppURL,isAutoLogin:WebIM.config.isAutoLogin,isMultiLoginSessions:WebIM.config.isMultiLoginSessions,apiUrl:WebIM.config.apiURL});var options={apiUrl:WebIM.config.apiURL,appKey:WebIM.config.appkey,user:data.data.imId,pwd:data.data.pwd};$scope.conn.open(options);$scope.conn.listen({onOpened:function(message){WebIM.utils.setCookie('webim_'+data.data.imId,message.accessToken,1);if((playId||playId==0)&&roomId){RTAll.userLogin(playId,roomId,0);}else{RTAll.redDotPush();}},onClosed:function(message){delete $scope.roomGoingData;delete $scope.lineupGoingData;delete $scope.prizesGoingData;if($.inArray(liveDataState,liveDataStateArr)!=-1){var userCookieId='webim_'+data.data.imId;var options={apiUrl:WebIM.config.apiURL,user:data.data.imId,pwd:data.data.pwd,accessToken:WebIM.utils.getCookie('webim_'+data.data.imId)[userCookieId],appKey:WebIM.config.appkey};$timeout(function(){},2000)}},onTextMessage:function(message){if(!isChat){if(roomId){RTAll.receipt(playId,roomId).then(function(data){});}if(message.ext.roomId==roomId&&message.ext.category==playId&&message.ext.messageTypeDisplay==0){if(message.ext.roomStatus==1||message.ext.roomStatus==3){if(message.ext.roomStatus==1){$scope.playing_noSendPirze=false}else if(message.ext.roomStatus==3){$scope.playing_noSendPirze=true}if(!message.ext.prizing){if(liveDataState=="tab.battleRoomgoing"){}else if(liveDataState=="tab.battle-prizes-going-detial"){}}else{}if(liveDataState=="tab.battle-lineupshow"){RTAll.lineupLive(roomId,userId).then(function(data){if(!data.code){$scope.lineupGoingData=data.data}})}if(getEventMsg){getEventMsg(message.ext);}$scope.$apply()}else if(message.ext.roomStatus==2){imLiveEnd(message.ext.category)}}else if(message.ext.messageTypeDisplay==1){pushRed(message.ext,message.ext.status);$(".battleTab").addClass("battleTabHot")}}if(message.type==="groupchat"){if(!isChat){}if(getEventMsg){getEventMsg(message);}}else if(message.type=="error"&&message.errorCode=="406"){if(getEventMsg){getEventMsg(message)}}},onEmojiMessage:function(message){console.log(message);if(isChat){if(getEventMsg){getEventMsg(message.ext);}}},onPictureMessage:function(message){console.log(message);if(isChat){if(getEventMsg){getEventMsg(message.ext);}}},onDeliveredMessage:function(message){console.log(message)},onReceivedMessage:function(message){console.log(message)},onOnline:function(){console.log("onLine")},onOffline:function(){$scope.alertAct("网络连接错误","重新刷新",playId,roomId,userId,liveDataState,getEventMsg)},onError:function(message){}})}})};$scope.connectLive=function(playId,roomId,userId,getEventMsg,isChat){if(typeof WebIM!="undefined"){if(!WebIM.connection){require(["webimConfig","strophe","websdk"],function(){$scope.connectLive(playId,roomId,userId,getEventMsg)})}else{if($scope.conn&&$scope.conn.isOpened()){$scope.conn.close();delete $scope.conn}if((playId||playId==0)&&roomId){$scope.playing_noSendPirze=false;$scope.getLiveData(playId,roomId,userId,getEventMsg,isChat);}else if(isChat){$scope.getLiveData(playId,roomId,userId,getEventMsg,isChat);}else{$scope.getLiveData();}}}else{require(["webimConfig","strophe","websdk"],function(){$scope.connectLive(playId,roomId,userId,getEventMsg,isChat)})}};function classLive(message){if(message.ext.matchList.length>0&&message.ext.userList.length>0){var nowUserId=Number(sessionStorage.getItem("userId_short"));$scope.roomGoingData=message.ext;angular.forEach($scope.roomGoingData.userList,function(dd,index){if(dd.userId==nowUserId){dd.rank=index+1;$scope.roomGoingData.mine=dd}})}}function prizesLive(message){if(message.ext.match.length>0){$scope.prizesGoingData=message.ext;if(message.ext.match.status==5){$scope.playing_noSendPirze=true}}}function imLiveEnd(category){sessionStorage.removeItem("battle_default");sessionStorage.removeItem("battle_prizes");sessionStorage.removeItem("battle_thr");switch(category){case 0:$url="/tab/battle/3//2";break;case 1:$url="/tab/battle/1/0/2";break;default:$url="/tab/battle/3//2";break}$location.path($url)}function pushRed(data,status){if(!$scope.battleRedHot){$scope.battleRedHot={}}if(status==1){if(!$scope.battleRedHot.playing){$scope.battleRedHot.playing={}}$scope.battleRedHot.playing.statusShow=true}else if(status==2){if(!$scope.battleRedHot.finished){$scope.battleRedHot.finished={}}$scope.battleRedHot.finished.statusShow=true}switch(data.category){case 0:if(status==1){if(!$scope.battleRedHot.playing.Tradition){$scope.battleRedHot.playing.Tradition={}}$scope.battleRedHot.playing.Tradition.showHas=true}if(status==2){if(!$scope.battleRedHot.finished.Tradition){$scope.battleRedHot.finished.Tradition={}}$scope.battleRedHot.finished.Tradition.showHas=true}break;case 1:if(status==1){if(!$scope.battleRedHot.playing.StarGuess){$scope.battleRedHot.playing.StarGuess={}}$scope.battleRedHot.playing.StarGuess.showHas=true}if(status==2){if(!$scope.battleRedHot.finished.StarGuess){$scope.battleRedHot.finished.StarGuess={}}$scope.battleRedHot.finished.StarGuess.showHas=true}break}}$scope.redDot=function(battleClick){RTAll.redDot().then(function(data){if(!data.code){var redSignArr=data.data;redSignArr.unplay=opearRed(redSignArr.unplay,0,battleClick);redSignArr.playing=opearRed(redSignArr.playing,1,battleClick);redSignArr.finished=opearRed(redSignArr.finished,2,battleClick);$scope.battleRedHot=redSignArr;if(redSignArr.unplay.statusShow||redSignArr.playing.statusShow||redSignArr.finished.statusShow){$(".battleTab").addClass("battleTabHot")}else{$(".battleTab").removeClass("battleTabHot")}}else{$(".battleTab").removeClass("battleTabHot")}})};function opearRed(data,status,battleClick){if(data){if(data.Tradition){data.Tradition=matchRed(data.Tradition,status,"classics",battleClick)}if(data.StarGuess){data.StarGuess=matchRed(data.StarGuess,status,"prizes",battleClick)}if(data.Three2Three){data.Three2Three=matchRed(data.Three2Three,status,"thrTothr",battleClick)}if(data.Tradition.showHas||(data.StarGuess&&data.StarGuess.showHas)||data.Three2Three.showHas){data.statusShow=true}else{data.statusShow=false}}return data}function matchRed(data,status,playKind,battleClick){var statusSign;var playSign;switch(status){case 0:statusSign="_noStart";break;case 1:statusSign="_going";break;case 2:statusSign="_end";break}switch(playKind){case "classics":playSign="traditionSign";break;case "prizes":playSign="starGuessSign";break;case "thrTothr":playSign="thrTothrSign";break}if(!statusSign||!playSign){return}var statusPlaySing=playSign+statusSign;if(data.has){if(status!==0){var traditionSign=localStorage.getItem(statusPlaySing);if(traditionSign){if(traditionSign==data.sign){data.showHas=false}else{data.showHas=true;}}else{data.showHas=true}}if(status===0){data.showHas=true;}}else{if(status!==0){sessionStorage.removeItem(statusPlaySing)}if(status===0){data.showHas=false;}}return data}$scope.$on("$ionicView.enter",function(){var currentPageState=$ionicHistory.currentStateName();var diffPageArr=['tab.hall-joinroom','tab.battle-lineup','tab.creamroom-success','tab.lineupShareEle'];if($.inArray(currentPageState,diffPageArr)==-1){if($scope._appId){$scope.creatShare(true)}}});$scope.creatShare=function(isMain,title,img,desc,roomId,shareHashUrl,shareCall){var _newUserPath="&newPath="+encodeURIComponent(encodeURIComponent(window.location.hostname+"/new.html?fromId="+localStorage.getItem("userId")));if(localStorage.getItem("userId")){var _parameterUrl="parametUser="+localStorage.getItem("userId")+"&parametTime="+new Date().getTime()}if(!isMain){switch($ionicHistory.currentStateName()){case "tab.hall-joinroom":var shareHashUrl=window.location.hash.substring(1);break;case "tab.battle-lineup":var shareHashUrl="/tab/hall/joinroom/"+roomId+"/";break;case "tab.creamroom-success":var shareHashUrl="/tab/hall/joinroom/"+roomId+"/";break;case "tab.lineupShareEle":var shareHashUrl=window.location.hash.substring(1);var _newUserPath="&newPath=";break;default:var shareHashUrl='';isMain=true;break}if(roomId){var _parameterUrl=_parameterUrl+"&parametRoom="+roomId}}var _parameter="&parameter="+encodeURIComponent(encodeURIComponent(_parameterUrl));var _getHash=isMain?"&hash=":"&hash="+encodeURIComponent(encodeURIComponent(shareHashUrl));var _AllParamet=_getHash+_newUserPath+_parameter;var shareUrl=window.location.href.split("#")[0]+_AllParamet;var privateData={title:title?title:"StarKings",url:shareUrl,img:img?img:window.location.hostname+"/img2.0/rank/lxkf_1.png",desc:desc?desc:"足球阵容竞猜游戏，猜真实比赛阵容，赢了就有钱"};wxShare(privateData,connectWX,shareCall)};$scope.showShareModal=function(shareAction,talkNum){$ionicModal.fromTemplateUrl('templates/common/shareModal.html',{scope:$scope}).then(function(modal){$scope.shareModal=modal;$scope.shareAction=shareAction;if(talkNum==0){TALKWATCH("公开房点击分享")}else if(talkNum==1){TALKWATCH("私密房点击分享")}else if(talkNum==2){TALKWATCH("加入房间点击分享")}else if(talkNum==3){TALKWATCH("已加入房间点击分享")}else if(talkNum==4){TALKWATCH("经典战排名点击分享")}$scope.shareModal.show();$scope.closeShareModal=function(){$scope.shareModal.remove()};$rootScope.$on('$locationChangeSuccess',function(){$scope.shareModal.remove()})})};$scope.chargeAction=function(msg,qx,qd,isCharge){$ionicModal.fromTemplateUrl('templates/common/charge.html',{scope:$scope}).then(function(modal){$scope.chargeModal=modal;$scope.msg=msg;$scope.isCharge=isCharge;$scope.qx=qx?qx:"取消";$scope.qd=qd?qd:"确定";$scope.chargeModal.show();$scope.cancel=function(){$scope.chargeModal.hide()};$scope.commit=function(){var url=url?url:"/tab/wode/sc";$location.path(url);$scope.chargeModal.hide()};$rootScope.$on('$locationChangeSuccess',function(ev,to,toParams,from,fromParams){$scope.isCharge=false;$scope.chargeModal.hide()})})};$scope.alert=function(msg){$scope.alertPopup=$ionicPopup.alert({cssClass:'erralert-popup',template:'<div class="alertText">'+msg+'</div>',okText:"确定"});$rootScope.$on('$locationChangeSuccess',function(ev,to,toParams,from,fromParams){$scope.alertPopup.close()});return $scope.alertPopup};$scope.alertDark=function(msg,callFunc){var alertPopup=$ionicPopup.alert({cssClass:'alert-popup',template:'<div class="alertText">'+msg+'</div>',okText:"确定"});alertPopup.then(function(res){if(callFunc){callFunc()}});$rootScope.$on('$locationChangeSuccess',function(ev,to,toParams,from,fromParams){alertPopup.close()});return alertPopup};$scope.alertAct=function(msg,msgOK,playId,roomId,userId,liveDataState,getEventMsg){$(".alert-popup").remove(0);var alertPopup=$ionicPopup.alert({cssClass:'alert-popup',template:'<div class="alertText">'+msg+'</div>',okText:msgOK});alertPopup.then(function(res){if(!window.navigator.onLine){alertPopup.close();$scope.alertAct(msg,msgOK,playId,roomId,userId,liveDataState,getEventMsg);return}if($scope.conn&&$scope.conn.isOpened()){$scope.conn.close()}if($.inArray(liveDataState,liveDataStateArr)!=-1){$scope.connectLive(playId,roomId,userId)}else{}});$rootScope.$on('$locationChangeSuccess',function(ev,to,toParams,from,fromParams){alertPopup.close()});return alertPopup};$scope.alertShut=function(msg){if(!msg){msg="";msg+="<div id=''><h1 class='a-text-color-light a-font-size-small'>房间奖励会随着房间参与人数的增加而增长</h1>";msg+="<div class=''><span class='a-text-color-light a-font-size-small'>当前奖励：</span><span class='a-text-color-whit a-font-size-small'>在当前房间人数情况下，相应名次所获得的奖励</span></div>";msg+="<div class=''><span class='a-text-color-light a-font-size-small'>最高奖励：</span><span class='a-text-color-whit a-font-size-small'>房间满人数下，相应名次所获得的奖励</span></div></div>"}var alertPopup=$ionicPopup.alert({cssClass:'alert-shut-popup',template:msg,okText:"<img class='a-img-size' style='margin: 0px;' src='../../img2.0/joinroom/jrfj_jjsm_2.png'/>"});alertPopup.then(function(res){});$rootScope.$on('$locationChangeSuccess',function(ev,to,toParams,from,fromParams){alertPopup.close()});return alertPopup};$scope.toast=function(msg){$ionicModal.fromTemplateUrl('templates/common/toast.html',{scope:$scope,animation:'fade-in'}).then(function(modal,$event){$scope.toastModal=modal;$scope.msg=msg;$scope.toastModal.show();$("#toast").parent(".modal-wrapper").siblings(".modal-backdrop-bg").css({background:"none"});$timeout(function(){$scope.toastModal.remove()},1500)});$rootScope.$on('$locationChangeSuccess',function(ev,to,toParams,from,fromParams){if($scope.toastModal){$scope.toastModal.remove()}})};$scope.toastDark=function(msg,msgSec,isHave){$ionicModal.fromTemplateUrl('templates/common/toastDark.html',{scope:$scope,animation:'fade-in'}).then(function(modal,$event){$scope.toastDarkModal=modal;$scope.msg=msg;$scope.isHave=isHave;if(msgSec){$scope.msgSec=msgSec}else{delete $scope.msgSec}$scope.toastDarkModal.show();$timeout(function(){$scope.toastDarkModal.remove()},1500)});$rootScope.$on('$locationChangeSuccess',function(ev,to,toParams,from,fromParams){if($scope.toastDarkModal){$scope.toastDarkModal.remove()}})};$scope.url_ts=function(msg,title){var confirmPopup=$ionicPopup.confirm({cssClass:'confirm-popup',title:title,template:'<p style="text-align:center;">'+msg+'</p>',cancelText:"取消",okText:"确定"});return confirmPopup};$scope.onceExchange=function(title,msg,btn,callFun){if(msg.money){var con='<span class="a-text-color-whitDark">还需<img class="a-img-size" src="../../img2.0/joinroom/zs_28.png"/><span class="a-text-color-whit">'+msg.money+'</span>&nbsp;，是否使用<img class="a-img-size" src="../../img2.0/hall/jdzdt_12.png" alt="" /><span class="a-text-color-whit">'+Number(msg.money)*$scope.sysPar.starToJewel+'</span>&nbsp;兑换?</span>'}else{return}var diamondExchange=$ionicPopup.confirm({cssClass:'exchange-popup',title:'<div class="font-weight a-text-color-light a-font-size-medium">'+title+'</div>',template:con,cancelText:"取消",okText:btn});diamondExchange.then(function(res){if(res){$ionicLoading.show();Wode.wode_xingbi(Number(msg.money)*$scope.sysPar.starToJewel).then(function(converResult){if(converResult.code==0){$ionicLoading.hide();if(callFun){callFun();}}else{$ionicLoading.hide();$scope.toastDark("提交失败，请重试")}},function(){$ionicLoading.hide();$scope.toastDark("提交失败，请重试")})}});$rootScope.$on('$locationChangeSuccess',function(ev,to,toParams,from,fromParams){if(diamondExchange){diamondExchange.close()}})};$scope.warnAlert=function(text,fun,cancel,ok){ok=ok?ok:"前往充值";cancel=cancel?cancel:"取消";if(fun=="清空提示"){fun='<img src="../../img2.0/lineup2.0/jdz_tc_js.png" alt="" /><span>'+text+'</span>';text=""}$scope.confirmPopup=$ionicPopup.confirm({cssClass:'warn-popup',template:fun,title:text,cancelText:cancel,okText:ok});$rootScope.$on('$locationChangeSuccess',function(ev,to,toParams,from,fromParams){$scope.confirmPopup.close()})};$scope.successsAlert=function(title,msg){$ionicModal.fromTemplateUrl('templates/common/successAlert.html',{scope:$scope,animation:'fade-in'}).then(function(modal,$event){$scope.successsAlert=modal;$scope.successsAlert.show();$(".successAlert").html("<h2>"+title+"</h2><p>"+msg+"</p>");})};$scope.exErrorAlert=function(title,msg){$ionicModal.fromTemplateUrl('templates/shop2.0/exErrorAlert.html',{scope:$scope,animation:'fade-in'}).then(function(modal,$event){$scope.ErrorAlert=modal;$scope.title=title;$scope.msg=msg;$scope.ErrorAlert.show()});$rootScope.$on('$locationChangeSuccess',function(ev,to,toParams,from,fromParams){$scope.ErrorAlert.remove()})};$scope.warnAlt=function(alt){$scope.alt=alt;$('.phone .warnAlt').slideDown(100);$timeout(function(){$('.phone .warnAlt').slideUp(100)},2000)};$scope.getViableExchange=function(ownValue,defaultValue){var dmdInt=parseInt(ownValue/10);angular.forEach(defaultValue,function(row,rowIndex){angular.forEach(row,function(item,index){if(item.coin>ownValue){item.noExchange=true}else{item.noExchange=false}})});return{"dmdInt":dmdInt,"defaultValue":defaultValue}};$scope.mmphone=function(phone){return phone.substr(0,3)+'****'+phone.substr(7)};$scope.showRules=function(ruleId){$ionicModal.fromTemplateUrl('templates/common/rule.html',{scope:$scope,animation:'fade-in'}).then(function(modal,$event){$scope.ruleModal=modal;$scope.whichRule=ruleId;$scope.ruleModal.show();$scope.closeModal=function(){$scope.ruleModal.remove()};$rootScope.$on('$locationChangeSuccess',function(ev,to,toParams,from,fromParams){$scope.closeModal()})})};$scope.successpink=function(msg){var confirmpink=$ionicPopup.alert({cssClass:'successpink-popup',template:"<div class='pinkbg'>"+msg+"</div>",cancelText:""});$timeout(function(){confirmpink.close()},2000)};$scope.roomhandle=function(list){angular.forEach(list,function(data,index,array){data.predictPrizePool=toThousands(data.predictPrizePool);data.entryNum=data.entry;data.entry=toThousands(data.entry);if(data.playTypeName=='第一名'){data.playType='16'}else if(data.playTypeName=="前三名"){data.playType='17'}else if(data.playTypeName=="前25%"){data.playType='18'}else if(data.playTypeName=="前50%"){data.playType='19'}else{data.playType='20'}data.mark=data.currUserNum/parseInt(data.totalUserCount)*100})};function connectWX(){var nowHref=window.location.href;RTAll.wxShare(nowHref.split("#")[0]).then(function(data){if(!data.code){$scope._appId=data.data.appId;privateWxConfig(data.data,false,connectWX);$scope.creatShare(true)}},function(){})}$scope.$on("$ionicView.afterEnter",function(){jsRequire("talkData");jsRequire("websdk");jsRequire("wx",connectWX)});var html=' <div id="carousel" ng-if="carouselshow" class="left-center" style="width: 90%;height: .24rem;display: -webkit-flex;display:flex;line-height: .24rem;top:.51rem;background: rgb(255,196,23);position: fixed;z-index: 10;background: url(../img2.0/main/gdbb_bg.png)no-repeat center ;background-size: 100% 100%;" class="a-flex-center">';html+='<span style="width: 6%;" class="a-flex-center"></span>';html+='<div id="carouseltext" style="width: 80%;height: 100%;;line-height: .24rem;position:relative;overflow: hidden;" class="a-font-size-small a-text-color-light"><nav id="wslider"  act-carouseltext  style="white-space: nowrap;position: absolute"></nav></div>';html+='<span style="width: 14%;" ng-click="carouselhide()"  class="a-flex-center"><img src="../img2.0/main/gdbb_ch.png"  style="height: .12rem;" /></span>';html+='</div>';var content=$compile(html)($scope);angular.element("ion-tabs").append(content);$scope.carousel=function(viewName){Hall.carousel().then(function(data){if(data&&data.code==0){$scope.carcontentAll=data.data;$scope.carcontent=$scope.carcontentAll[0];$scope.degreeAll=$scope.carcontentAll.length<=3?$scope.carcontentAll.length:3;$scope.carouselshow=true;return false}});$rootScope.$on('$locationChangeSuccess',function(ev,to,toParams,from,fromParams){$scope.carouselshow=false});$scope.degree=1;$scope.$on("childChange",function(e,m){$scope.carouselshow=m})};$scope.isNocticePage=function(stateName){var degreeStr=sessionStorage.getItem("degreeStr");if(Number(degreeStr)){$scope.carousel($ionicHistory.currentView().stateName)}};$scope.nameGet=function(userId){$scope.peopleType=userId;$scope.isUser=false;if(!$scope.userData){$scope.userInfoDetial();return false}if(userId==$scope.userData.userId){$scope.isUser=true}$ionicLoading.show();Wode.headSummary($scope.peopleType).then(function(data){if(data&&data.code==0){$scope.otherPeople=data.data;$ionicModal.fromTemplateUrl('templates/mine/mineModal/mineInforRevise.html',{scope:$scope,animation:'fade-in'}).then(function(modal){$scope.inforReviseMod=modal;$scope.inforReviseMod.show()});$rootScope.$on('$locationChangeSuccess',function(ev,to,toParams,from,fromParams){$scope.inforReviseMod.remove()})}$ionicLoading.hide()});$scope.historyQuery=function(id){if(id==$scope.userData.userId){$location.path('/tab/battle/3//2');return false}Battle.list(2,"",1,id).then(function(dataAll){if(dataAll.code==0){console.log(dataAll);$location.path('/tab/hisBattle/3/'+id);sessionStorage.setItem("battle_default_his",JSON.stringify(dataAll))}})}}}ctrl.$inject=["$scope","$compile","$location","$stateParams","$ionicHistory","$ionicLoading","$timeout","$rootScope","$ionicModal","$ionicPopup","Hall","Battle","Prizes","LineUp","Rank","Wode","Thr","RTAll"];app.registerController("AllCtrl",ctrl);});